{"version":3,"file":"logger-decorator.es5.js","sources":["../src/lib/utils.ts","../src/lib/opt/default-base-option.ts","../src/lib/opt/default-function-option.ts","../src/lib/message.ts","../src/lib/performance-now-polyfill.ts","../src/lib/function-wrapper.ts","../src/function-decorator.ts","../src/lib/opt/default-class-option.ts","../src/class-decorator.ts","../src/normal-decorator.ts"],"sourcesContent":["const STRIP_COMMENTS = /((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/mg\nconst ARGUMENT_NAMES = /([^\\s,]+)/g\n\n/**\n * Return the keys of the target object\n * @param data target object\n * @return the keys of the input object\n */\nexport const keys = (data: Object) => {\n  return Object.keys(data)\n}\n\n/**\n * Get the parameters of one function\n * @param func target function\n * @return the parameters of function\n */\nexport const getArsName = (func: Function) => {\n  const fnStr = func.toString().replace(STRIP_COMMENTS, '')\n  const result = fnStr.slice(fnStr.indexOf('(') + 1, fnStr.indexOf(')')).match(ARGUMENT_NAMES) || []\n  return result\n}\n\n/**\n * Check if the target object is empty of not\n * @param obj target object\n * @return whether the object is empty or not\n */\nexport const isObjEmpty = (obj: any) => {\n  return obj && Object.keys(obj).length === 0 && obj.constructor === Object\n}\n\n/**\n * A function that check if the script is running on node or not.\n * @return whether running on nodejs environment\n */\nexport const runningOnNode = () => {\n  return typeof window === 'undefined'\n}","import { IBaseOption } from './../interface/IBaseOption';\n\nexport const defaultOpt: IBaseOption = {\n  classProperties: false,\n  log: console.log,\n  withTime: true,\n  disable: false,\n  duration: false,\n}\n","import { IFunctionOption } from './../interface/IFunctionOption';\nimport { defaultOpt } from './default-base-option'\n\nexport const defaultFuncOpt: IFunctionOption = Object.assign(defaultOpt, {\n  withParams: false,\n  logReturn: false,\n  beginMessage: ''\n})\n","import { getArsName } from './utils';\nimport { IFunctionOption } from './interface/IFunctionOption';\n\nconst TAB = '    '\n\nconst getArgsList = (func: Function, values: any[]) => {\n  return getArsName(func).map((param, index) => {\n    return `${param}: ${values[index]}`\n  }).join(',')\n}\n\nconst concatMsg = (...args: string[]): string => {\n  return args.filter(el => el && el !== '').join(' ')\n}\n\nconst getProperties = (classObj: any): string => {\n  return Object.keys(classObj).reduce((msg: string[], el) => {\n    msg.push(`${el}: ${classObj[el]}`)\n    return msg\n  }, []).join(' ')\n}\n\nexport const message = (\n  options: IFunctionOption,\n  that: any,\n  arg: any[],\n  name: string,\n  func: Function,\n) => {\n  const logger = options.log || console.log\n\n\n  // print basic info of function\n  const className = (that && that.constructor && that.constructor.name) || ''\n  const time = options.withTime ? (new Date()).toISOString() : ''\n  logger(concatMsg(time, `[${className}#${name}] START`))\n\n  // print begin message if there are any\n  options.beginMessage && logger(`${TAB}${options.beginMessage}`)\n\n  options.classProperties && logger(`${TAB}Class Properties: [${getProperties(that)}]`)\n\n  // print parameters of function\n  options.withParams && logger(`${TAB}Parameters: [${getArgsList(func, arg)}]`)\n}\n\nexport const messageEnd = (\n  options: IFunctionOption,\n  duration: number,\n  that: any,\n  name: string,\n  returnValue?: any\n) => {\n  const logger = options.log || console.log\n\n  options.duration && logger(`${TAB}Function spent: ${duration.toFixed(3)}ms`)\n\n  options.logReturn && returnValue && logger(`${TAB}Return Value: ${returnValue}`)\n\n  const className = (that && that.constructor && that.constructor.name) || ''\n  logger(`[${className}#${name}] END`)\n}\n","/**\n * @return return the current time info when on node environment\n */\nconst getTimeOnNode = () => {\n  const hrTime = process.hrtime()\n  return hrTime[0] * 1e9 + hrTime[1]\n}\n\n/**\n * Polyfill of performance.now function\n * Get the value of performance.now() on both node or web browser.\n * @return the performance.now()\n */\nexport const now = () => {\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\n    return performance.now()\n  } else if (typeof process !== undefined && typeof process.hrtime === 'function') {\n    return (function(loadTime) {\n      return (getTimeOnNode() - loadTime) / 1e9\n    })(getTimeOnNode() - (process.uptime() * 1e9))\n  } else {\n    return (function(loadTime) {\n      return (new Date()).getTime() - loadTime\n    })((new Date).getTime())\n  }\n}","import { IFunctionOption } from './interface/IFunctionOption';\nimport { message, messageEnd } from './message'\nimport { now } from './performance-now-polyfill'\n\nexport const FunctionWrapper = (\n  func: Function,\n  funcName: string,\n  options: IFunctionOption\n) => {\n  return function(...args: any[]) {\n    message(options, this, args, funcName, func)\n    const startTime = now()\n    const result = func.apply(this, args)\n    messageEnd(options, (now() - startTime), this, funcName, result)\n    return result\n  }\n}","import { isObjEmpty } from './lib/utils';\nimport { defaultFuncOpt } from './lib/opt/default-function-option';\nimport { IFunctionOption } from './lib/interface/IFunctionOption';\nimport { FunctionWrapper } from './lib/function-wrapper';\n\nconst decorateFunc = (descriptor: any, field: string, value: any) => {\n  const oldFunc = descriptor.value\n  oldFunc[field] = value\n  descriptor.value = oldFunc\n  return descriptor\n}\n\nexport const FuncLogger = (opt?: Partial<IFunctionOption>) => {\n  return function(target: any, name: string, descriptor: any) {\n    return isObjEmpty(opt) ? descriptor : decorateFunc(descriptor, '__opt', opt)\n  }\n}\n\nexport const DisableLogger = () => {\n  return function(target: any, name: String, descriptor: any) {\n    return decorateFunc(descriptor, '__disable_logger', true)\n  }\n}\n\nexport const Logger = (opt?: Partial<IFunctionOption>) => {\n  const options = {...defaultFuncOpt, ...opt}\n  return function(target: any, name: string, descriptor: any) {\n    if (options.disable) return descriptor\n    const oldFunc = descriptor.value\n    descriptor.value = FunctionWrapper(oldFunc, name, options)\n    return descriptor\n  }\n}","import { defaultFuncOpt } from './default-function-option';\nimport { IClassOption } from './../interface/IClassOption';\n\nexport const defaultClassOpt: IClassOption = Object.assign(defaultFuncOpt, {})","import { defaultClassOpt } from './lib/opt/default-class-option';\nimport { IClassOption } from './lib/interface/IClassOption';\nimport { keys } from './lib/utils'\nimport { FunctionWrapper } from './lib/function-wrapper'\n\nexport const ClassLogger = (opt?: Partial<IClassOption>) => {\n  let options = {...defaultClassOpt, ...opt}\n  return (target: any) => {\n    if (options.disable) return\n    keys(target.prototype).map(funcName => {\n      const oldFunc = target.prototype[funcName]\n\n      if (oldFunc.__disable_logger) return\n\n      const individualOpt = oldFunc.__opt ? {...options, ...oldFunc.__opt } : options\n      if (individualOpt.disable) return\n      target.prototype[funcName] = FunctionWrapper(oldFunc, funcName, individualOpt)\n    })\n  }\n}\n","import { IFunctionOption } from './lib/interface/IFunctionOption'\nimport { defaultFuncOpt } from './lib/opt/default-function-option';\nimport { FunctionWrapper } from './lib/function-wrapper';\n\nexport const logDecorate = (opt?: Partial<IFunctionOption>) => {\n  const options = {...defaultFuncOpt, ...opt}\n  return (...args: Function[]): any => {\n    return args.reduce(function(result: any, el: Function) {\n      const funcName = el.name\n      el = FunctionWrapper(el, funcName, options)\n      result[funcName] = el\n      return result\n    }, {})\n  }\n}"],"names":[],"mappings":"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"}